<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevSage - Reset Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom glassmorphism and animations */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .animate-fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }

        .animate-slide-up {
            animation: slideUp 0.6s ease-out;
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Form styles */
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #4facfe;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Button styles */
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Password strength indicator */
        .password-strength {
            height: 4px;
            border-radius: 2px;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .strength-weak { background: #ef4444; }
        .strength-fair { background: #f59e0b; }
        .strength-good { background: #10b981; }
        .strength-strong { background: #059669; }

        /* Loading spinner */
        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Success state */
        .success-state {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Error states */
        .form-error {
            border-color: #ef4444 !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }

        .form-success {
            border-color: #10b981 !important;
            background: rgba(16, 185, 129, 0.1) !important;
        }

        .error-message {
            color: #fca5a5;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        /* Floating elements */
        .floating-element {
            position: absolute;
            opacity: 0.1;
            pointer-events: none;
        }

        .floating-code {
            font-family: 'Courier New', monospace;
            color: rgba(255, 255, 255, 0.2);
            font-size: 14px;
        }

        /* Token validation states */
        .token-invalid {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .token-expired {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* Password requirements */
        .requirement {
            transition: all 0.3s ease;
        }

        .requirement.met {
            color: #10b981;
        }

        .requirement.unmet {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .reset-container {
                margin: 1rem;
                padding: 2rem 1.5rem;
            }
        }
    </style>
</head>

<body class="gradient-bg flex items-center justify-center p-4">
    <!-- Floating Code Elements -->
    <div class="floating-element top-10 left-10 animate-float floating-code">
        const newPassword = hash(password);
    </div>
    <div class="floating-element top-20 right-20 animate-float floating-code" style="animation-delay: -2s;">
        if (tokenValid && passwordStrong) { updatePassword(); }
    </div>
    <div class="floating-element bottom-20 left-20 animate-float floating-code" style="animation-delay: -4s;">
        user.password = await bcrypt.hash(newPassword);
    </div>
    <div class="floating-element bottom-10 right-10 animate-float floating-code" style="animation-delay: -1s;">
        // Secure password reset
    </div>

    <!-- Main Container -->
    <div class="reset-container glass rounded-3xl p-8 w-full max-w-md animate-slide-up">
        <!-- Loading State: Validating Token -->
        <div id="loadingState" class="text-center">
            <div class="mb-8 animate-fade-in">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 p-6 rounded-2xl inline-block mb-4">
                    <i class="fas fa-spinner spinner text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Validating Reset Link</h1>
                <p class="text-white text-opacity-70">Please wait while we verify your reset token...</p>
            </div>
        </div>

        <!-- Valid Token State: Reset Form -->
        <div id="resetState" class="hidden">
            <!-- Logo and Header -->
            <div class="text-center mb-8 animate-fade-in">
                <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-4 rounded-2xl inline-block mb-4">
                    <i class="fas fa-shield-alt text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Reset Your Password</h1>
                <p class="text-white text-opacity-70">Create a new secure password for your account</p>
            </div>

            <!-- User Info -->
            <div class="glass-dark rounded-xl p-4 mb-6 animate-fade-in" style="animation-delay: 0.1s;">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-500 bg-opacity-20 p-2 rounded-full">
                        <i class="fas fa-user text-blue-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-medium">Resetting password for</p>
                        <p id="userEmail" class="text-blue-400 text-sm">user@example.com</p>
                    </div>
                </div>
            </div>

            <!-- Reset Form -->
            <form id="resetForm" class="space-y-6">
                <!-- New Password Field -->
                <div class="animate-fade-in" style="animation-delay: 0.2s;">
                    <label for="newPassword" class="block text-sm font-medium text-white mb-2">
                        New Password
                    </label>
                    <div class="relative">
                        <input
                            type="password"
                            id="newPassword"
                            name="newPassword"
                            placeholder="Enter your new password"
                            class="form-input w-full px-4 py-3 pl-12 pr-12 rounded-xl"
                            required
                        >
                        <i class="fas fa-lock absolute left-4 top-4 text-white text-opacity-60"></i>
                        <button
                            type="button"
                            id="toggleNewPassword"
                            class="absolute right-4 top-4 text-white text-opacity-60 hover:text-white transition-colors"
                        >
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-strength" id="passwordStrength"></div>
                    <div id="newPassword-error" class="error-message hidden"></div>
                </div>

                <!-- Confirm Password Field -->
                <div class="animate-fade-in" style="animation-delay: 0.3s;">
                    <label for="confirmPassword" class="block text-sm font-medium text-white mb-2">
                        Confirm New Password
                    </label>
                    <div class="relative">
                        <input
                            type="password"
                            id="confirmPassword"
                            name="confirmPassword"
                            placeholder="Confirm your new password"
                            class="form-input w-full px-4 py-3 pl-12 pr-12 rounded-xl"
                            required
                        >
                        <i class="fas fa-lock absolute left-4 top-4 text-white text-opacity-60"></i>
                        <button
                            type="button"
                            id="toggleConfirmPassword"
                            class="absolute right-4 top-4 text-white text-opacity-60 hover:text-white transition-colors"
                        >
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div id="confirmPassword-error" class="error-message hidden"></div>
                </div>

               

                <!-- Reset Button -->
                <button
                    type="submit"
                    id="resetPasswordButton"
                    class="btn-primary w-full py-3 rounded-xl text-white font-medium animate-fade-in"
                    style="animation-delay: 0.5s;"
                >
                    <span id="resetPasswordButtonText">Reset Password</span>
                    <i id="resetPasswordSpinner" class="fas fa-spinner spinner ml-2 hidden"></i>
                </button>

                <!-- Error Message -->
                <div id="resetPasswordError" class="hidden p-4 bg-red-500 bg-opacity-20 border border-red-500 border-opacity-30 rounded-xl">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-exclamation-triangle text-red-400"></i>
                        <span id="resetPasswordErrorText" class="text-red-200 text-sm"></span>
                    </div>
                </div>
            </form>
        </div>

        <!-- Success State: Password Reset -->
        <div id="successState" class="text-center hidden">
            <div class="mb-8 animate-fade-in">
                <div class="success-state p-6 rounded-2xl inline-block mb-4">
                    <i class="fas fa-check-circle text-white text-4xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Password Reset Successfully</h1>
                <p class="text-white text-opacity-70">Your password has been updated securely</p>
            </div>

            <!-- Success Message -->
            <div class="glass-dark rounded-xl p-6 mb-6 animate-fade-in" style="animation-delay: 0.1s;">
                <div class="space-y-3 text-sm text-white text-opacity-80">
                    <div class="flex items-center gap-3">
                        <div class="bg-green-500 bg-opacity-20 p-1 rounded-full">
                            <i class="fas fa-check text-green-400 text-xs"></i>
                        </div>
                        <span>Password updated with strong encryption</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="bg-green-500 bg-opacity-20 p-1 rounded-full">
                            <i class="fas fa-check text-green-400 text-xs"></i>
                        </div>
                        <span>All active sessions have been logged out</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="bg-green-500 bg-opacity-20 p-1 rounded-full">
                            <i class="fas fa-check text-green-400 text-xs"></i>
                        </div>
                        <span>Security notification sent to your email</span>
                    </div>
                </div>
            </div>

            <!-- Login Button -->
            <button
                id="goToLogin"
                class="btn-primary w-full py-3 rounded-xl text-white font-medium animate-fade-in"
                style="animation-delay: 0.2s;"
            >
                <i class="fas fa-sign-in-alt mr-2"></i>
                Sign In with New Password
            </button>
        </div>

        <!-- Invalid Token State -->
        <div id="invalidTokenState" class="text-center hidden">
            <div class="mb-8 animate-fade-in">
                <div class="token-invalid p-6 rounded-2xl inline-block mb-4">
                    <i class="fas fa-times-circle text-white text-4xl animate-shake"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Invalid Reset Link</h1>
                <p class="text-white text-opacity-70">This password reset link is not valid</p>
            </div>

            <!-- Error Details -->
            <div class="glass-dark rounded-xl p-6 mb-6 animate-fade-in" style="animation-delay: 0.1s;">
                <h3 class="font-medium text-white mb-4">Possible reasons:</h3>
                <div class="space-y-3 text-sm text-white text-opacity-80 text-left">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-exclamation-triangle text-red-400 mt-0.5"></i>
                        <span>The link has already been used</span>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-exclamation-triangle text-red-400 mt-0.5"></i>
                        <span>The link is malformed or incomplete</span>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-exclamation-triangle text-red-400 mt-0.5"></i>
                        <span>The reset request was cancelled</span>
                    </div>
                </div>
            </div>

            <!-- Request New Reset -->
            <button
                id="requestNewReset"
                class="btn-primary w-full py-3 rounded-xl text-white font-medium animate-fade-in"
                style="animation-delay: 0.2s;"
            >
                <i class="fas fa-redo mr-2"></i>
                Request New Reset Link
            </button>
        </div>

       

        <!-- Back to Login (shown in error states) -->
        <div id="backToLoginSection" class="mt-8 text-center animate-fade-in hidden" style="animation-delay: 0.3s;">
            <a href="#" id="backToLogin" class="text-blue-400 hover:text-blue-300 transition-colors text-sm flex items-center justify-center gap-2">
                <i class="fas fa-arrow-left"></i>
                Back to Login
            </a>
        </div>

        <!-- Help Section -->
        <div class="mt-8 text-center animate-fade-in" style="animation-delay: 0.4s;">
            <p class="text-white text-opacity-50 text-sm">
                <i class="fas fa-question-circle mr-2"></i>
                Need help? <a href="#" class="text-blue-400 hover:text-blue-300">Contact Support</a>
            </p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Get reset token from URL
        const urlParams = new URLSearchParams(window.location.search);
        const resetToken = urlParams.get('token');

        // State elements
        const loadingState = document.getElementById('loadingState');
        const resetState = document.getElementById('resetState');
        const successState = document.getElementById('successState');
        const invalidTokenState = document.getElementById('invalidTokenState');
        const expiredTokenState = document.getElementById('expiredTokenState');
        const backToLoginSection = document.getElementById('backToLoginSection');

        // Form elements
        const resetForm = document.getElementById('resetForm');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const resetPasswordButton = document.getElementById('resetPasswordButton');
        const resetPasswordButtonText = document.getElementById('resetPasswordButtonText');
        const resetPasswordSpinner = document.getElementById('resetPasswordSpinner');
        const resetPasswordError = document.getElementById('resetPasswordError');
        const resetPasswordErrorText = document.getElementById('resetPasswordErrorText');

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (!resetToken) {
                showInvalidTokenState();
                return;
            }

            // Validate token
            validateResetToken(resetToken);

            // Initialize password functionality
            initializePasswordHandlers();
        });

        // Validate reset token
        async function validateResetToken(token) {
            try {
                // Simulate token validation API call
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simulate different token states
                if (token === 'invalid123') {
                    showResetState('user@example.com');
                } else if (token === 'expired123') {
                    showExpiredTokenState();
                } else {
                    showInvalidTokenState();
                }
                
            } catch (error) {
                showInvalidTokenState();
            }
        }

        // Show different states
        function showResetState(email) {
            loadingState.classList.add('hidden');
            resetState.classList.remove('hidden');
            document.getElementById('userEmail').textContent = email;
        }

        function showSuccessState() {
            resetState.classList.add('hidden');
            successState.classList.remove('hidden');
        }

        function showInvalidTokenState() {
            loadingState.classList.add('hidden');
            invalidTokenState.classList.remove('hidden');
            backToLoginSection.classList.remove('hidden');
        }

        function showExpiredTokenState() {
            loadingState.classList.add('hidden');
            expiredTokenState.classList.remove('hidden');
            backToLoginSection.classList.remove('hidden');
        }

        // Initialize password handlers
        function initializePasswordHandlers() {
            // Password visibility toggles
            document.getElementById('toggleNewPassword').addEventListener('click', function() {
                togglePasswordVisibility('newPassword', this);
            });

            document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
                togglePasswordVisibility('confirmPassword', this);
            });

            // Password strength checker
            newPasswordInput.addEventListener('input', function() {
                checkPasswordStrength(this.value);
                checkPasswordRequirements(this.value);
            });

            // Real-time validation
            newPasswordInput.addEventListener('blur', validateNewPassword);
            confirmPasswordInput.addEventListener('blur', validateConfirmPassword);
        }

        // Password visibility toggle
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        // Password strength checker
        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('passwordStrength');
            
            let strength = 0;
            let strengthClass = '';
            
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            switch (strength) {
                case 0:
                case 1:
                    strengthClass = 'strength-weak';
                    break;
                case 2:
                case 3:
                    strengthClass = 'strength-fair';
                    break;
                case 4:
                    strengthClass = 'strength-good';
                    break;
                case 5:
                    strengthClass = 'strength-strong';
                    break;
            }
            
            strengthBar.className = `password-strength ${strengthClass}`;
            strengthBar.style.width = `${(strength / 5) * 100}%`;
        }

        // Password requirements checker
        function checkPasswordRequirements(password) {
            const requirements = {
                'req-length': password.length >= 8,
                'req-lowercase': /[a-z]/.test(password),
                'req-uppercase': /[A-Z]/.test(password),
                'req-number': /[0-9]/.test(password),
                'req-special': /[^A-Za-z0-9]/.test(password)
            };

            Object.entries(requirements).forEach(([reqId, met]) => {
                const element = document.getElementById(reqId);
                const icon = element.querySelector('i');
                
                if (met) {
                    element.className = 'requirement met flex items-center gap-2';
                    icon.className = 'fas fa-check text-xs';
                } else {
                    element.className = 'requirement unmet flex items-center gap-2';
                    icon.className = 'fas fa-circle text-xs';
                }
            });
        }

        // Validation functions
        function validateNewPassword() {
            const password = newPasswordInput.value;
            
            if (!password) {
                showFieldError('newPassword', 'New password is required');
                return false;
            }
            
            if (password.length < 8) {
                showFieldError('newPassword', 'Password must be at least 8 characters');
                return false;
            }
            
            if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z\d])/.test(password)) {
                showFieldError('newPassword', 'Password must meet all requirements');
                return false;
            }
            
            clearFieldError('newPassword');
            return true;
        }

        function validateConfirmPassword() {
            const password = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (!confirmPassword) {
                showFieldError('confirmPassword', 'Please confirm your password');
                return false;
            }
            
            if (password !== confirmPassword) {
                showFieldError('confirmPassword', 'Passwords do not match');
                return false;
            }
            
            clearFieldError('confirmPassword');
            return true;
        }

        // Helper functions
        function showFieldError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + '-error');
            
            field.classList.add('form-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function clearFieldError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + '-error');
            
            field.classList.remove('form-error');
            field.classList.add('form-success');
            errorDiv.classList.add('hidden');
        }

        function showResetError(message) {
            resetPasswordErrorText.textContent = message;
            resetPasswordError.classList.remove('hidden');
        }

        function hideResetError() {
            resetPasswordError.classList.add('hidden');
        }

        // Form submission
        resetForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate all fields
            const isNewPasswordValid = validateNewPassword();
            const isConfirmPasswordValid = validateConfirmPassword();
            
            if (!isNewPasswordValid || !isConfirmPasswordValid) {
                return;
            }
            
            // Show loading state
            resetPasswordButton.disabled = true;
            resetPasswordButtonText.textContent = 'Resetting Password...';
            resetPasswordSpinner.classList.remove('hidden');
            hideResetError();
            
            try {
                // Simulate password reset API call
                await simulatePasswordReset();
                
                // Show success state
                showSuccessState();
                
            } catch (error) {
                showResetError(error.message);
                
                // Reset button
                resetPasswordButton.disabled = false;
                resetPasswordButtonText.textContent = 'Reset Password';
                resetPasswordSpinner.classList.add('hidden');
            }
        });

        // Simulate password reset API call
        async function simulatePasswordReset() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Simulate success (in real app, this would make API call)
                    resolve({ success: true });
                }, 2000);
            });
        }

        // Button handlers
        document.getElementById('goToLogin').addEventListener('click', function() {
            window.location.href = '/login';
        });

        document.getElementById('requestNewReset').addEventListener('click', function() {
            window.location.href = '/forgot-password';
        });

        document.getElementById('requestNewResetExpired').addEventListener('click', function() {
            window.location.href = '/forgot-password';
        });

        document.getElementById('backToLogin').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = '/login';
        });

        // Demo scenarios
        console.log('Demo scenarios:');
        console.log('- Add "?token=valid123" to URL for valid token');
        console.log('- Add "?token=invalid123" to URL for invalid token');
        console.log('- Add "?token=expired123" to URL for expired token');
        console.log('- No token parameter shows invalid state');
    </script>
</body>

</html>